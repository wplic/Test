(function () {
	var tl = $("#recordTitle"),
	rd = $("#recordDateSel"),
	rt = $("#recordTimeSel"),
	rc = $("#recordColor"),
	delRecdBtn = $("#delCancel"),
	curMonthRecordList = null;
	function showTips(text, sucFun, failFun) {
		var t = $("#recordTips");
		t.html(text).css("display", "block").animate({
			top : 135,
			opacity : 1
		});
		setTimeout(function () {
			t.animate({
				top : 125,
				opacity : 0
			}).css("display", "none");
			sucFun && sucFun();
		}, 1500);
	}
	function input(theInput, val) {
		var $input = $("#" + theInput + ""),
		val = val;
		$input.attr({
			value : val
		});
		$input.focus(function () {
			if ($input.val() == val) {
				$(this).attr({
					value : ""
				});
			}
		}).blur(function () {
			if ($input.val() == "") {
				$(this).attr({
					value : val
				});
			}
		});
	}
	if (!("placeholder" in document.createElement("input"))) {
		input("recordTitle", "请添加主题，最多144个汉字");
	}
	function clearRecdCache() {
		var $da = /\d{4}\-\d{1,2}\-\d{1,2}/.exec($("#info_all").text()),
		$dt = /(\d{1,2}\:\d{1,2})\:\d{1,2}/.exec($(".wt").text())[1];
		if (!("placeholder" in document.createElement("input"))) {
			tl.val("请添加主题，最多144个汉字").css("height", "28px");
		} else {
			tl.val("").css("height", "28px");
		}
		rd.val($da || "");
		rt.val($dt || "");
		$(".listc-centent>p").remove();
	}
	var Calendar = {
		show_page : {
			Login : $("#login_in"),
			Date : $("#date_show"),
			Count : $("#date_count"),
			RecordSave : $("#record_save"),
			RecordList : $("#record_list")
		}
	};
	window.showPageFun = showPageFun;
	function showPageFun(p, bacFun) {
		delRecdBtn.hide();
		if (p && Calendar.show_page[p]) {
			var s = Calendar.show_page[p];
			$(".content-c>div").hide();
			$("#date_count_btn").removeClass("a_4");
			$("#record_saved").removeClass("a_4");
			s.fadeIn(300);
			if (bacFun) {
				bacFun();
			}
			return 1;
		}
	}
	$(".a_5").click(function (e) {
		var e = reEvent(e),
		t = $(this);
		// if ($("#logoutfrombaidu").length == 0) {
		// 	$("#loginwithbaidu").trigger("click");
		// 	return;
		// }
		//if (!window.Note && window.Note.uid) {
		if (!(window.Note && window.Note.uid)) {
			$("#loginwithbaidu").trigger("click");
			if(!window.Note.uid){
				window.Note.path = 1;
			}
			return;
		}
		clearRecdCache();
		if (!t.hasClass("a_4") && showPageFun("RecordSave") == 1) {
			t.addClass("a_4");
		} else {
			if (t.hasClass("a_4")) {
				if (showPageFun("Date") == 1) {
					t.removeClass("a_4");
					getRecordByM();
				}
			}
		}
		try {
			if (!$("#recordDateSel").datepicker) {
				$.getScript("scripts/date.min.js", function () {
					$("#recordDateSel").datepicker();
					$("#recordTitle").autoTextarea({
						maxHeight : 150,
						minHeight : 28
					});
				});
			}
		} catch (ex) {}
		
	});

	$("#recordSave").click(function (e) {
		var e = reEvent(e),
		tlV = $.trim(tl.val()),
		rdV = $.trim(rd.val()),
		rtV = $.trim(rt.val()),
		rcV = $.trim(rc.val()) || 1;
		if (!tlV) {
			showTips("请添加主题，最多144个汉字");
			tl.focus();
			return;
		}
		if (tlV == "请添加主题，最多144个汉字") {
			showTips("请添加主题");
			tl.focus();
			return;
		}
		if (!rdV || !/\d{4}\-\d{1,2}\-\d{1,2}/.exec(rdV)) {
			showTips("请添加日期，格式如：2012-12-12");
			rd.focus();
			return;
		}
		if (!rtV || !/\d{1,2}\:\d{1,2}/.exec(rtV)) {
			showTips("请添加时间，格式如12:12");
			rt.focus();
			return;
		}
		if ($("#delCancel").css("display") == "none") {
			Calendar.saveFun({
				title : tlV,
				date_ymd : rdV + " " + rtV,
				color : rcV,
				type : "add_nonte",
				uid : window.Note.uid || ''
			}, function () {
				showTips("保存成功！", function () {
					getRecordByMList(rd.val());
					clearRecdCache();
				});
			}, function (d) {
				showTips(d || "保存失败！");
			});
		} else {
			Calendar.updateFun({
				id : tl.attr("data-id") || "",
				title : tlV,
				date_ymd : rdV + " " + rtV,
				color : rcV,
				uid : window.Note.uid || ""
			}, function (t) {
				showTips("保存成功！", function () {
					getRecordByMList(rd.val());
					clearRecdCache();
				});
			}, function (t) {
				showTips("保存失败！");
			});
		}
	});
	$("#saveCancel").click(function (e) {
		reEvent(e);
		var t = $(this);
		if ($("#delCancel").css("display") == "none" && t.attr("data-from") != "RecordList") {
			clearRecdCache();
			showPageFun("Date");
		} else {
			getRecordByMList();
		}
	});
	$("#recordColorList a").click(function (e) {
		var e = reEvent(e),
		t = $(this),
		tEx = $("#recordColor");
		if (t.attr("id") != "recordColor") {
			tEx.css("background", t.css("background")).attr("data-color", t.attr("data-colorId"));
		}
	});
	$(".siblingDayRecd").click(function (e) {
		var e = reEvent(e),
		t = $(this);
		if (t.attr("id") === "prevDayRecd") {
			if (to_day.id === cld.firstWeek) {
				pushBtm("MU", true);
				$(".calendar td").eq(cld.length + cld.firstWeek - 1).trigger("click");
				getRecordByMList();
			} else {
				$(".calendar td").eq(to_day.id - 1).trigger("click");
				showRecordList(parseInt($("#info_today").text()));
			}
		} else {
			if (to_day.id + 1 === cld.length + cld.firstWeek) {
				pushBtm("MD", true);
				$(".calendar td").eq(cld.firstWeek).trigger("click");
				getRecordByMList();
			} else {
				$(".calendar td").eq(to_day.id + 1).trigger("click");
				showRecordList(parseInt($("#info_today").text()));
			}
		}
	});
	$("#newRecord").click(function (e) {
		reEvent(e);
		showPageFun("RecordSave", function () {
			$(".a_5").addClass("a_4");
			$("#saveCancel").attr("data-from", "RecordList");
		});
	});
	$("#record-list-con").delegate("p", "click", function (e) {
		reEvent(e);
		var t = $(this),
		day = t.attr("data-day"),
		ind = t.attr("data-index"),
		d = curMonthRecordList,
		stitle = d.data[day][ind].title || "请添加主题，最多144个汉字",
		sdate_ymd = d.data[day][ind].date_ymd || "",
		stime = /(\d{1,2}\:\d{1,2})\:\d{1,2}/.exec(sdate_ymd)[1] || "",
		sdata = /\d{4}\-\d{1,2}\-\d{1,2}/.exec(sdate_ymd)[0] || "";
		$("#recordTitle").val(stitle).attr("data-id", t.attr("data-id"));
		$("#recordDateSel").val(sdata);
		$("#recordTimeSel").val(stime);
		showPageFun("RecordSave", function () {
			delRecdBtn.show();
		});
	});
	$("#delCancel").click(function (e) {
		reEvent(e);
		Calendar.delFun({
			id : tl.attr("data-id") || "",
			uid : window.Note.uid || ""
		}, function (t) {
			showTips("删除成功！", function () {
				getRecordByMList();
			});
		}, function (t) {
			showTips(t || "删除失败！");
		});
	});
	$(".js").live("click", function (e) {
		var e = reEvent(e);
		if (e.cancelBubble) {
			e.cancelBubble = true;
		} else {
			e.stopPropagation();
		}
		try {
			if (!$("#recordDateSel").datepicker) {
				$.getScript("scripts/date.min.js", function () {
					$("#recordDateSel").datepicker();
					$("#recordTitle").autoTextarea({
						maxHeight : 150,
						minHeight : 28
					});
				});
			}
		} catch (ex) {}
		
		var e = reEvent(e),
		t = $(this),
		ind = t.attr("data-day");
		showRecordList(ind);
	});
	function showRecordList(ind, mInd) {
		if (!ind) {
			return;
		}
		$("#select-month-option ul li").eq(parseInt(mInd) - 1).trigger("click");
		$(".calendar td").eq(parseInt(cld.firstWeek) + parseInt(ind) - 1).trigger("click");
		try {
			clearRecdCache();
			var d = curMonthRecordList,
			list = "",
			dl = d.data[ind];
			if (!dl || dl.length == 0) {
				if ($("#recordListNull").length === 0) {
					$("#record-list-con").html('<span id="recordListNull" style="margin: 6px 5px;color: #666;display: block;">今日无记事</span>');
				}
			} else {
				for (var i = 0, l = dl.length; i < l; i++) {
					list += '<p data-id="' + dl[i].id + '" data-day="' + ind + '" data-index="' + i + '" title="' + dl[i].title + "  " + dl[i].date_ymd + '"><b class="listc-icons"></b><span class="listc-time">' + /(\d{1,2}\:\d{1,2})\:\d{1,2}/.exec(dl[i].date_ymd)[1] + "</span><em>" + dl[i].title + "</em></p>";
				}
				$("#recordListNull").remove();
				$("#record-list-con").html(list);
			}
			showPageFun("RecordList");
			$(".a_5").addClass("a_4");
		} catch (ex) {
			return;
		}
	}
	$(".a_3").click(function (e) {
		var e = reEvent(e),
		t = $(this);
		if (!t.hasClass("a_4") && showPageFun("Count") == 1) {
			t.addClass("a_4");
		} else {
			if (t.hasClass("a_4")) {
				if (showPageFun("Date") == 1) {
					t.removeClass("a_4");
				}
			}
		}
	});
	$(".holidays_ul li").hover(function () {
		$(this).addClass("hover");
	}, function () {
		$(this).removeClass("hover");
	});
	$(".holidays_ul li").click(function (e) {
		var e = reEvent(e);
		if (showPageFun("Date") == 1) {
			closeMenuAni($(".holidays_ul"));
			$("#current-data-month").text($(this).attr("rel"));
			$("#current-data").text();
			var yy = $(this).attr('rev');
			changeCld(yy);
		}
	});
	$(".select-year li").hover(function () {
		$(this).addClass("hover");
	}, function () {
		$(this).removeClass("hover");
	});
	$(".select-year li").click(function (e) {
		var e = reEvent(e),
		t = $(this);
		if (t.closest(".year-data").find(".current-data").length != 0) {
			t.closest(".year-data").find(".current-data").text(t.text());
		} else {
			t.closest(".month-data").find("#current-data-month").text(t.text());
		}
		var yy = $('#current-data-month').text()-1;
		changeCld(yy);
		$(".year-data").removeClass("hv");
		$("#month-data").removeClass("month_hv");
		closeMenuAni(t.closest(".select-wrap"));
		showPageFun("Date");
	});
	$(".a_2").click(function (e) {
		var e = reEvent(e);
		if ($(".holidays_ul").css("display") === "none") {
			showMenuAni($(".holidays_ul"), 20);
		}
	});
	$("#current-data-month").click(function (e) {
		var e = reEvent(e);
		var t = $(this);
		if ($("#select-month-option").css("display") === "block") {
			t.parent().removeClass("month_hv");
			closeMenuAni(t.next());
		} else {
			var year = $("#select-year-option");
			closeMenuAni(year);
			year.parent().removeClass("hv");
			t.parent().addClass("month_hv");
			showMenuAni(t.next());
		}
	});
	function loadJS(r) {
		var s = document.createElement("script");
		s.src = r;
		s.type = "text/javascript";
		document.body.appendChild(s);
	}
	function loadCSS(r) {
		var s = document.createElement("link");
		s.href = r;
		s.type = "text/css";
		document.getElementsByTagName("head")[0].appendChild(s);
	}
	function showMenuAni(el, top) {
		el.css("display", "block").animate({
			opacity : 1,
			top : top || 22
		}, 200);
	}
	function closeMenuAni(el, top) {
		el.animate({
			opacity : 0,
			top : top || 10
		}, 200, function () {
			el.css("display", "none");
		});
	}
	function reEvent(e) {
		var e = e || window.event;
		if (e.preventDefault) {
			e.preventDefault();
		} else {
			e.returnValue = false;
		}
		return e;
	}
	$("#current-data").click(function (e) {
		var e = reEvent(e),
		t = $(this);
		if ($("#select-year-option").css("display") === "block") {
			t.parent().removeClass("hv");
			closeMenuAni(t.next());
		} else {
			var mon_list = $("#select-month-option");
			closeMenuAni(mon_list);
			mon_list.parent().removeClass("month_hv");
			showMenuAni(t.next());
			t.parent().addClass("hv");
			t.next().scrollTop(1980);
		}
	});
	$("body").click(function (e) {
		var t = e.target || e.srcElement;
		if ($("#select-year-option").css("display") === "block") {
			if (!$(t).hasClass("select-wrap") && !$(t).hasClass("select-year") && !$(t).parent().hasClass("select-year") && !$(t).hasClass("current-data")) {
				closeMenuAni($("#select-year-option"));
				$(".year-data").removeClass("hv");
			}
		}
		if ($("#select-month-option").css("display") === "block") {
			if (!$(t).hasClass("select-wrap") && !$(t).hasClass("select-year") && !$(t).parent().hasClass("select-year") && !$(t).hasClass("current-data") && !$(t).hasClass("month-data")) {
				closeMenuAni($("#select-month-option"));
				$("#month-data").removeClass("month_hv");
			}
		}
		if ($(".holidays_ul").css("display") === "block") {
			if (!$(t).hasClass("holidays_ul") && !$(t).hasClass("a_2") && !$(t).parent().hasClass("holidays_ul")) {
				closeMenuAni($(".holidays_ul"));
			}
		}
	});
	window.getTimes = 0;
	var getTimetoDom = function (t) {
		if (t != "" && t != null && t != "undefined") {
			window.getTimes = t;
		}
		if (window.getTimes) {
			var date = new Date(Number(window.getTimes) * 1000);
			$(".wt").text("标准北京时间：" + date.toTimeString().substr(0, 8));
			window.getTimes = Number(window.getTimes) + 1;
			setTimeout(function () {
				getTimetoDom(0);
			}, 1000);
		}
	};
	var getWeather = function () {
		if (!to_day.ip) {
			setTimeout(function () {
				getWeather();
			}, 1000);
			return false;
		}
		$.ajax({
			url : "weather.php",
			type : "post",
			data : "w=" + to_day.ip + "&type=weather",
			cache : false,
			success : function (data) {
				if (data.trim() !== "") {
					$(".weather span.tq").text(data);
					$(".weather span.tq").attr("title", data);
				}
			}
		});
	};

	setTimeout(function () {
		//getNong();
	}, 1000);
})();
var weeks = new Array("日", "一", "二", "三", "四", "五", "六", "日");
function weekDays(a) {
	return weeks[a];
}
function callA() {
	var h = true;
	var g = document.getElementById("inYear").value;
	if (g.length != 4) {
		document.getElementById("result1").innerHTML = "显示结果";
		h = false;
	}
	if (!/^\d+$/.test(g)) {
		document.getElementById("inYear").value = "";
		document.getElementById("result1").innerHTML = "显示结果";
		h = false;
	}
	var b = document.getElementById("inMonth").value;
	if (!/^\d+$/.test(b) || b > 12 || b <= 0) {
		document.getElementById("inMonth").value = "";
		document.getElementById("result1").innerHTML = "显示结果";
		h = false;
	}
	var f = document.getElementById("inData").value;
	if (!/^\d+$/.test(f) || f > new Date(g, b, 0).getDate() || f <= 0) {
		document.getElementById("inData").value = "";
		document.getElementById("result1").innerHTML = "显示结果";
		h = false;
	}
	var e = document.getElementById("decday").value;
	if (e === "" || e.length === 0) {
		document.getElementById("result1").innerHTML = "显示结果";
		h = false;
	}
	if (!/^\-?\d*$/.test(e)) {
		document.getElementById("decday").value = "";
		document.getElementById("result1").innerHTML = "显示结果";
		h = false;
	} else {
		if (/^\-$/.test(e)) {
			h = false;
		}
	}
	if (!h) {
		return;
	}
	var c = new Date(g, b - 1, f).getTime() + e * 24000 * 3600;
	var a = new Date();
	a.setTime(c);
	document.getElementById("result1").innerHTML = a.getFullYear() + "年  " + (1 + a.getMonth()) + "月  " + a.getDate() + "日    星期" + weekDays(a.getDay());
}
function callB() {
	var b = true;
	var f = document.getElementById("inYear2").value;
	if (f.length != 4) {
		document.getElementById("result2").innerHTML = "显示结果";
		b = false;
	}
	if (!/^\d+$/.test(f)) {
		document.getElementById("inYear2").value = "";
		document.getElementById("result2").innerHTML = "显示结果";
		b = false;
	}
	var h = document.getElementById("inMonth2").value;
	if (!/^\d+$/.test(h) || h > 12 || h <= 0) {
		document.getElementById("inMonth2").value = "";
		document.getElementById("result2").innerHTML = "显示结果";
		b = false;
	}
	var a = document.getElementById("inData2").value;
	if (!/^\d+$/.test(a) || a > new Date(f, h, 0).getDate() || a <= 0) {
		document.getElementById("inData2").value = "";
		document.getElementById("result2").innerHTML = "显示结果";
		b = false;
	}
	var d = document.getElementById("inYear3").value;
	if (d.length != 4) {
		document.getElementById("result2").innerHTML = "显示结果";
		b = false;
	}
	if (!/^\d+$/.test(d)) {
		document.getElementById("inYear3").value = "";
		document.getElementById("result2").innerHTML = "显示结果";
		b = false;
	}
	var g = document.getElementById("inMonth3").value;
	if (!/^\d+$/.test(g) || g > 12 || g <= 0) {
		document.getElementById("inMonth3").value = "";
		document.getElementById("result2").innerHTML = "显示结果";
		b = false;
	}
	var i = document.getElementById("inData3").value;
	if (!/^\d+$/.test(i) || i > new Date(d, g, 0).getDate() || i <= 0) {
		document.getElementById("inData3").value = "";
		document.getElementById("result2").innerHTML = "显示结果";
		b = false;
	}
	if (!b) {
		return;
	}
	var e = new Date(f, h - 1, a);
	var c = new Date(d, g - 1, i);
	document.getElementById("result2").innerHTML = Math.abs(Math.round((c - e) / 86400000)) + " 天";
}
$(function () {
	window.location.toString().indexOf("canvas_pos=search") === -1 && $("#divBor").addClass("app-bg")
	//alert(window.location.toString().indexOf("canvas_pos=search")===-1)
});
(function (a) {
	a.fn.autoTextarea = function (b) {
		var d = {
			maxHeight : null,
			minHeight : a(this).height()
		};
		var c = a.extend({}, d, b);
		return a(this).each(function () {
			a(this).bind("paste cut keydown keyup focus blur", function () {
				var e,
				f = this.style;
				this.style.height = c.minHeight + "px";
				if (this.scrollHeight > c.minHeight) {
					if (c.maxHeight && this.scrollHeight > c.maxHeight) {
						e = c.maxHeight;
						f.overflowY = "scroll";
					} else {
						e = this.scrollHeight;
						f.overflowY = "hidden";
					}
					f.height = e + "px";
				}
			});
		});
	};
})(jQuery);

function weatherCallback(ip){
	$.getJSON('http://baidu.uqude.com/weather/getWeatherAction.action?ip='+ip+'&callbak=?')
}

var toObject = function(a) { 
	var o = {}; 
	for (var i=0, j=a.length; i<j; i=i+1) { // 这里我调整了下, YUI源码中是i<a.length 
		o[a[i]] = true; 
	} 
	return o; 
}; 
var keys = function(o) { 
	var a=[], i; 
	for (i in o) { 
		if (o.hasOwnProperty(i)) { // 这里, YUI源码中是lang.hasOwnProperty(o, i) 
			a.push(i); 
		} 
	} 
	return a; 
}; 
var uniq = function(a) { 
	return keys(toObject(a)); 
};

